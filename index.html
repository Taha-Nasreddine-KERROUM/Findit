<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FindIt ‚Äì Campus Lost & Found</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ -->
<div class="topbar">
    <button class="circle-btn logo-btn" onclick="goHome()"><span>Fi</span></button>
    <div class="search-island">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="searchInput" placeholder="Search items, places, people‚Ä¶" autocomplete="off">
        <button class="search-clear" id="searchClear" aria-label="Clear search">‚úï</button>
    </div>
    <button class="circle-btn menu-btn" id="menuBtn" onclick="toggleMenu()">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </button>
</div>

<!-- MENU DROPDOWN -->
<div class="menu-dropdown" id="menuDropdown">
    <div id="menuNotLoggedIn">
        <div class="menu-item login" onclick="openLogin()">Log in / Sign up</div>
        <div class="menu-divider"></div>
        <div class="menu-item" onclick="toggleMenu()">Settings</div>
    </div>
    <div id="menuLoggedIn" style="display:none">
        <div class="menu-item" style="gap:8px;padding:8px 10px" onclick="openOwnProfile()">
            <div class="menu-avatar-sm" id="menuAvatarSm" style="background:var(--accent)">Me</div>
            <div>
                <div style="font-size:13px;font-weight:600" id="menuUserName">My Profile</div>
                <div style="font-size:11px;color:var(--muted)" id="menuUserHandle">u/me</div>
            </div>
        </div>
        <div class="menu-divider"></div>
        <div id="adminMenuItem" style="display:none" class="menu-item" onclick="openAdminDashboard()">
            <span style="font-size:13px;color:var(--recovered);font-weight:500">Admin Dashboard ‚Üó</span>
        </div>
        <div class="menu-item" onclick="signOut()">Sign out</div>
        <div class="menu-item" onclick="toggleMenu()">Settings</div>
    </div>
</div>

<!-- ‚îÄ‚îÄ FILTER CHIPS ‚îÄ‚îÄ -->
<div class="search-filters">
    <div class="filter-chip active" data-filter="all">All</div>
    <div class="filter-chip" data-filter="found">Found</div>
    <div class="filter-chip" data-filter="lost">Lost</div>
    <div class="filter-chip" data-filter="waiting">Waiting</div>
    <div class="filter-chip" data-filter="recovered">Recovered</div>
    <div class="filter-chip" data-filter="main library">Library</div>
    <div class="filter-chip" data-filter="cafeteria">Cafeteria</div>
    <div class="filter-chip" data-filter="engineering">Engineering</div>
    <div class="filter-chip" data-filter="dorms">Dorms</div>
    <div class="filter-chip" data-filter="sports">Sports</div>
</div>

<!-- ‚îÄ‚îÄ FEED ‚îÄ‚îÄ -->
<div class="feed" id="feed"></div>

<!-- EMPTY STATE -->
<div class="empty-state" id="emptyState">
    <div class="empty-icon">üîç</div>
    <div class="empty-title">Nothing found</div>
    <div class="empty-sub">Try a different search term or filter</div>
</div>

<!-- ‚îÄ‚îÄ FAB ‚îÄ‚îÄ -->
<button class="fab-post" onclick="tryPost()">
    <svg width="19" height="19" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
</button>

<!-- OVERLAY (comments) -->
<div class="overlay" id="overlay" onclick="closeComments()"></div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- ‚îÄ‚îÄ COMMENTS PANEL ‚îÄ‚îÄ -->
<div class="comments-panel" id="commentsPanel">
    <div class="panel-handle">
        <span class="panel-title" id="panelTitle">Comments</span>
        <div class="panel-right">
            <button class="panel-share" onclick="shareItem(this)">
                <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                Share
            </button>
            <button class="close-panel" onclick="closeComments()">‚úï</button>
        </div>
    </div>
    <div class="comments-scroll" id="commentsScroll"></div>
    <div id="commentInputWrap" class="comment-input-wrap">
        <div id="commentImagePreviewWrap" style="display:none;align-items:center;gap:8px;padding:0 0 8px 0">
            <img id="commentImagePreview" style="max-height:60px;max-width:80px;border-radius:6px;display:block;object-fit:cover">
            <button onclick="clearCommentImage()" style="background:rgba(0,0,0,0.6);color:#fff;border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;font-size:10px;line-height:1;flex-shrink:0">‚úï</button>
        </div>
        <div style="display:flex;align-items:center;gap:6px;width:100%">
            <input type="file" id="commentImageInput" accept="image/*" style="display:none" onchange="handleCommentImageFile(this.files[0])">
            <button class="action-btn" onclick="document.getElementById('commentImageInput').click()" style="padding:0 8px;flex-shrink:0" title="Attach image">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="3"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            </button>
            <input class="comment-input" id="commentInput" placeholder="Write a comment‚Ä¶" onkeydown="if(event.key==='Enter')submitCommentClick()">
            <button class="send-btn" style="flex-shrink:0" onclick="submitCommentClick()">
                <svg width="13" height="13" fill="none" stroke="white" stroke-width="2.5" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            </button>
        </div>
    </div>
    <div id="commentLoginPrompt" style="display:none;padding:12px 16px;border-top:1px solid var(--border);text-align:center">
        <span style="font-size:13px;color:var(--muted)">
            <a onclick="closeComments();openLogin()" style="color:var(--accent);cursor:pointer;font-weight:500">Sign in</a> to join the conversation
        </span>
    </div>
</div>

<!-- ‚îÄ‚îÄ PROFILE OVERLAY + SHEET ‚îÄ‚îÄ -->
<div class="sheet-overlay" id="profileOverlay" onclick="closeProfile()"></div>
<div class="bottom-sheet" id="profileSheet">
    <div class="profile-top-row">
        <div class="profile-left">
            <div class="profile-pic" id="pAvatar" style="background:#4da6ff">AB</div>
            <div>
                <div class="profile-name" id="pName">Amir B.</div>
                <div class="profile-handle" id="pHandle">u/amir_b</div>
                <div class="profile-points" id="pPoints">840 points</div>
            </div>
        </div>
        <button class="sheet-close-btn" onclick="closeProfile()">‚úï</button>
    </div>
    <div class="profile-stats">
        <div class="stat"><div class="stat-num" id="pStatPosted">‚Ä¶</div><div class="stat-label">Posted</div></div>
        <div class="stat"><div class="stat-num" id="pStatReturned">‚Ä¶</div><div class="stat-label">Recovered</div></div>
        <div class="stat"><div class="stat-num" id="pStatComments">‚Ä¶</div><div class="stat-label">Comments</div></div>
    </div>
    <button class="profile-msg-btn" id="profileMsgBtn" onclick="openDM()">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        Message
    </button>
    <div class="activity-label">Activity</div>
    <div id="profileHistoryList"></div>
</div>



<!-- ‚îÄ‚îÄ DM SHEET ‚îÄ‚îÄ -->
<div class="dm-sheet" id="dmSheet">
    <div class="dm-header">
        <div class="dm-avatar" id="dmAvatar" style="background:#4da6ff">AB</div>
        <div><div class="dm-name" id="dmName">Amir B.</div><div class="dm-online">online</div></div>
        <button class="dm-close" onclick="closeDM()">‚úï</button>
    </div>
    <div class="dm-messages" id="dmMessages"></div>
    <div class="dm-input-wrap">
        <input class="dm-input" placeholder="Message‚Ä¶" id="dmInput" onkeydown="if(event.key==='Enter')sendDMClick()">
        <button class="send-btn" onclick="sendDMClick()">
            <svg width="13" height="13" fill="none" stroke="white" stroke-width="2.5" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
    </div>
</div>

<!-- ‚îÄ‚îÄ LOCATION SHEET ‚îÄ‚îÄ -->
<div class="sheet-overlay" id="locOverlay" onclick="closeLocation()"></div>
<div class="bottom-sheet loc-sheet" id="locSheet">
    <div class="loc-header">
        <div>
            <div class="loc-title" id="locTitle"></div>
            <div class="loc-count" id="locCount"></div>
        </div>
        <button class="sheet-close-btn" onclick="closeLocation()">‚úï</button>
    </div>
    <div id="locList"></div>
</div>

<!-- ‚îÄ‚îÄ POST MODAL ‚îÄ‚îÄ -->
<div class="modal-bg" id="postModal" onclick="if(event.target===this)closePost()">
    <div class="modal-box">
        <div class="modal-title">Post an Item</div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Location</label>
                <select class="form-select" id="postLocation">
                    <option>Main Library</option><option>Cafeteria</option>
                    <option>Engineering Building</option><option>Sports Complex</option>
                    <option>Dorms ‚Äì Block A</option><option>Dorms ‚Äì Block B</option>
                    <option>Admin Building</option><option>Parking Lot</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Category</label>
                <select class="form-select" id="postCategory">
                    <option>Electronics</option><option>Bags</option><option>Accessories</option>
                    <option>Clothing</option><option>ID / Cards</option><option>Keys</option><option>Other</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-select" id="postStatus">
                    <option value="found">Found</option><option value="lost">Lost</option><option value="waiting">Waiting</option>
                </select>
            </div>
        </div>
        <div class="form-group" style="margin-bottom:11px">
            <label class="form-label">Title</label>
            <input class="form-input" id="postTitle" type="text" placeholder="e.g. Black backpack with red keychain">
        </div>
        <div class="form-group" style="margin-bottom:11px">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="postDesc" placeholder="Describe the item, exact location, time, identifying features‚Ä¶"></textarea>
        </div>
        <!-- Image upload: browse + paste + drag-drop -->
        <div class="form-group" style="margin-bottom:11px">
            <label class="form-label">Photo <span style="color:var(--muted);font-weight:400">(optional)</span></label>
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('postImageInput').click()" ondragover="event.preventDefault();this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')" ondrop="handleImageDrop(event)">
                <input type="file" id="postImageInput" accept="image/*" style="display:none" onchange="handleImageFile(this.files[0])">
                <div id="uploadPlaceholder">
                    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" style="margin-bottom:6px;opacity:0.4"><rect x="3" y="3" width="18" height="18" rx="3"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                    <div class="upload-text">Browse or paste a photo</div>
                    <div class="upload-optional">Click to browse ¬∑ Paste from clipboard ¬∑ Drag &amp; drop</div>
                </div>
                <div id="uploadPreviewWrap" style="display:none;position:relative">
                    <img id="uploadPreview" style="width:100%;border-radius:8px;display:block;height:auto">
                    <button onclick="event.stopPropagation();clearImage()" style="position:absolute;top:4px;right:4px;background:rgba(0,0,0,0.6);color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:13px;line-height:1">‚úï</button>
                </div>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closePost()">Cancel</button>
            <button class="btn-submit" id="postSubmitBtn" onclick="submitPost()">Post</button>
        </div>
    </div>
</div>

<!-- ‚îÄ‚îÄ EDIT MODAL ‚îÄ‚îÄ -->
<div class="modal-bg" id="editModal" onclick="if(event.target===this)closeEdit()">
    <div class="modal-box">
        <div class="modal-title">Edit Post</div>
        <div class="form-group" style="margin-bottom:11px">
            <label class="form-label">Title</label>
            <input class="form-input" id="editTitle" type="text">
        </div>
        <div class="form-group" style="margin-bottom:11px">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="editDesc"></textarea>
        </div>
        <div class="form-group" style="margin-bottom:12px">
            <label class="form-label">Status</label>
            <div class="status-options">
                <div class="status-opt" data-status="found" onclick="selectStatus(this,'found')">Found</div>
                <div class="status-opt" data-status="lost" onclick="selectStatus(this,'lost')">Lost</div>
                <div class="status-opt" data-status="waiting" onclick="selectStatus(this,'waiting')">Waiting</div>
                <div class="status-opt" data-status="recovered" onclick="selectStatus(this,'recovered')">Recovered</div>
            </div>
        </div>
        <!-- Image upload in edit modal -->
        <div class="form-group" style="margin-bottom:12px">
            <label class="form-label">Photo <span style="color:var(--muted);font-weight:400">(optional)</span></label>
            <div class="upload-area" id="editUploadArea" onclick="document.getElementById('editImageInput').click()" ondragover="event.preventDefault();this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')" ondrop="event.preventDefault();this.classList.remove('drag-over');handleEditImageFile(event.dataTransfer.files[0])">
                <input type="file" id="editImageInput" accept="image/*" style="display:none" onchange="handleEditImageFile(this.files[0])">
                <div id="editUploadPlaceholder">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" style="margin-bottom:4px;opacity:0.4"><rect x="3" y="3" width="18" height="18" rx="3"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                    <div class="upload-text">Click to change photo</div>
                </div>
                <div id="editUploadPreviewWrap" style="display:none;position:relative">
                    <img id="editImagePreview" style="width:100%;border-radius:8px;display:block;height:auto">
                    <button onclick="event.stopPropagation();clearEditImage()" style="position:absolute;top:4px;right:4px;background:rgba(0,0,0,0.6);color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:13px;line-height:1">‚úï</button>
                </div>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeEdit()">Cancel</button>
            <button class="btn-submit" onclick="saveEdit()">Save</button>
        </div>
    </div>
</div>

<!-- ‚îÄ‚îÄ CONFIRM DELETE ‚îÄ‚îÄ -->
<div class="modal-bg" id="confirmModal" onclick="if(event.target===this)closeConfirm()">
    <div class="modal-box confirm-box">
        <div class="confirm-title">Delete this post?</div>
        <div class="confirm-sub">This can't be undone. The post will be permanently removed.</div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeConfirm()">Cancel</button>
            <button class="btn-danger" onclick="confirmDelete()">Delete</button>
        </div>
    </div>
</div>

<!-- ‚îÄ‚îÄ ADMIN MODAL ‚îÄ‚îÄ -->
<div class="modal-bg" id="adminModal" onclick="if(event.target===this)closeAdmin()">
    <div class="modal-box" style="max-width:400px">
        <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:16px;margin-bottom:4px;display:flex;align-items:center;gap:8px">
            <span class="admin-badge">Admin</span> Panel
        </div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:18px">Moderation actions for this member</div>
        <div class="admin-action" onclick="adminAction('delete')">
            <div class="admin-action-icon" style="background:rgba(224,90,90,0.12)">üóë</div>
            <div><div class="admin-action-text">Delete Post</div><div class="admin-action-desc">Remove post from the platform</div></div>
        </div>
        <div class="admin-action" onclick="adminAction('ban')">
            <div class="admin-action-icon" style="background:rgba(224,90,90,0.12)">üö´</div>
            <div><div class="admin-action-text">Ban Member</div><div class="admin-action-desc">Block this user from posting</div></div>
        </div>
        <div class="admin-action" onclick="adminAction('unban')">
            <div class="admin-action-icon" style="background:rgba(34,201,122,0.12)">‚úÖ</div>
            <div><div class="admin-action-text">Unban Member</div><div class="admin-action-desc">Restore access for this user</div></div>
        </div>
        <div class="admin-action" onclick="adminAction('alert')" style="margin-bottom:0">
            <div class="admin-action-icon" style="background:rgba(232,168,56,0.12)">‚ö†Ô∏è</div>
            <div><div class="admin-action-text">Send Alert</div><div class="admin-action-desc">Warn this user about their activity</div></div>
        </div>
        <div class="modal-actions" style="margin-top:14px">
            <button class="btn-cancel" onclick="closeAdmin()">Close</button>
        </div>
    </div>
</div>

<!-- ‚îÄ‚îÄ SIGN IN REQUIRED ‚îÄ‚îÄ -->
<div class="modal-bg" id="signinReqModal" onclick="if(event.target===this)closeSigninReq()">
    <div class="modal-box signin-req-box">
        <div class="signin-req-icon">üîí</div>
        <div class="signin-req-title">Sign in to post</div>
        <div class="signin-req-sub">You need to be signed in to create a post on FindIt.</div>
        <button class="btn-full btn-submit" style="margin-bottom:8px" onclick="closeSigninReq();openLogin()">Sign in</button>
        <button class="btn-full btn-cancel" onclick="closeSigninReq()">Maybe later</button>
    </div>
</div>

<!-- ‚îÄ‚îÄ LOGIN MODAL ‚îÄ‚îÄ -->
<div class="modal-bg" id="loginModal" onclick="if(event.target===this)closeLogin()">
    <div class="modal-box login-box">
        <div class="login-logo">
            <div class="login-logo-circle"><span>Fi</span></div>
            <div class="login-logo-name">FindIt</div>
        </div>

        <!-- Tab switcher -->
        <div id="loginMainWrap">
            <div style="display:flex;gap:0;margin-bottom:18px;background:var(--surface2);border-radius:10px;padding:3px">
                <button id="tabLoginBtn" onclick="switchLoginTab('login')"
                    style="flex:1;padding:7px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;background:var(--surface);color:var(--text);font-family:inherit">
                    Log in
                </button>
                <button id="tabRegisterBtn" onclick="switchLoginTab('register')"
                    style="flex:1;padding:7px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;background:transparent;color:var(--muted);font-family:inherit">
                    Sign up
                </button>
            </div>

            <!-- Login tab -->
            <div id="loginTab">
                <input class="login-input" type="text" id="loginUid" placeholder="Username" autocomplete="username" onkeydown="if(event.key==='Enter')document.getElementById('loginPw').focus()">
                <input class="login-input" type="password" id="loginPw" placeholder="Password" autocomplete="current-password" style="margin-top:8px" onkeydown="if(event.key==='Enter')doLogin()">
                <div id="loginError" style="display:none;color:#e05a5a;font-size:12px;margin-top:6px;text-align:center"></div>
                <button class="btn-full btn-submit" onclick="doLogin()" style="margin-top:12px" id="loginBtn">Log in</button>
            </div>

            <!-- Register tab -->
            <div id="registerTab" style="display:none">
                <input class="login-input" type="text" id="regName" placeholder="Display name (e.g. Khalid)" onkeydown="if(event.key==='Enter')document.getElementById('regUid').focus()">
                <input class="login-input" type="text" id="regUid" placeholder="Username (letters, numbers, _)" autocomplete="username" style="margin-top:8px" onkeydown="if(event.key==='Enter')document.getElementById('regPw').focus()">
                <input class="login-input" type="password" id="regPw" placeholder="Password (min 6 characters)" autocomplete="new-password" style="margin-top:8px" onkeydown="if(event.key==='Enter')doRegister()">
                <div id="registerError" style="display:none;color:#e05a5a;font-size:12px;margin-top:6px;text-align:center"></div>
                <button class="btn-full btn-submit" onclick="doRegister()" style="margin-top:12px" id="registerBtn">Create account</button>
            </div>

            <div class="login-admin-line" style="margin-top:12px">
                Admin authority?
                <a class="login-admin-link" onclick="showAdminRequest()">Request access</a>
            </div>
        </div>

        <!-- Admin request form -->
        <div id="adminRequestWrap" style="display:none">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
                <button onclick="backToLogin()" style="background:none;border:none;color:var(--muted);font-size:18px;cursor:pointer;padding:0;line-height:1">‚Üê</button>
                <div class="login-title" style="margin-bottom:0">Request Admin Access</div>
            </div>
            <div class="login-sub">Fill in this form and a super admin will review your request.</div>
            <input class="login-input" type="text" id="arName" placeholder="Your full name">
            <input class="login-input" type="text" id="arRole" placeholder="Your role (e.g. Library Staff)" style="margin-top:7px">
            <textarea class="login-input" id="arReason" placeholder="Why do you need admin access?" rows="3" style="margin-top:7px;resize:none;font-family:inherit"></textarea>
            <button class="btn-full btn-submit" style="margin-top:10px" onclick="submitAdminRequest()">Submit Request</button>
        </div>

        <!-- Admin request sent -->
        <div id="adminRequestSent" style="display:none;text-align:center;padding:6px 0">
            <div style="font-size:34px;margin-bottom:9px">‚úÖ</div>
            <div class="login-sent-title">Request Submitted</div>
            <div class="login-sent-msg">Your request has been sent to the admin team.</div>
        </div>

        <span class="login-close" onclick="closeLogin()">Cancel</span>
    </div>
</div>

<script src="api.js"></script>
<script src="data.js"></script>
<script src="app.js"></script>
</body>
</html>
